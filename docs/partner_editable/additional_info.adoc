// Add steps as necessary for accessing the software, post-configuration, and testing. Donâ€™t include full usage instructions for your software, but add links to your product documentation for that information.
//Should any sections not be applicable, remove them

=== Post deployment: AWS Config and AWS CloudTrail log permissions

[start=1]
. Security Hub uses service-linked https://docs.aws.amazon.com/config/latest/developerguide/evaluate-config.html[AWS Config rules^]. Make sure that AWS Config is turned on and recording all supported resources, including global resources, in all accounts and regions where Security Hub is deployed. You are not charged by AWS Config for these service-linked rules. You are only charged according to https://aws.amazon.com/security-hub/pricing/[AWS Security Hub pricing^].

. This Quick Start uses an AWS Key Management Service (AWS KMS) key to remediate the link:#_coverage[PCI.CloudTrail.1 control]. The AWS KMS key must have permissions to encrypt/decrypt AWS CloudTrail logs in the AWS account in which this Quick Start is deployed. So, after deploying this Quick Start, make sure you update the AWS KMS key policy with the AWS account ID. To do this, navigate to the AWS KMS console and search for a key with an alias of "PCI-CMK". Then, see link:https://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-kms-key-policy-for-cloudtrail.html#create-kms-key-policy-for-cloudtrail-policy-sections[Required CMK policy sections for use with CloudTrail^] for instructions to enable CloudTrail log encrypt and decrypt permissions.

== Test the deployment
// If steps are required to test the deployment, add them here. If not, remove the heading
AWS Security Hub begins to run security checks within two hours after you deploy the PCI DSS and AWS Foundational Security Best Practices controls. After the initial check, subsequent checks occur on a periodic or change-triggered basis, depending on the control. For more information, see https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-schedule.html[Schedule for running security checks^]. Follow the steps in this section to test the deployment.

The following steps test remediation of the link:#_coverage[PCI EC2.2] control. This control states that the VPC default security group should prohibit inbound and outbound traffic, and it is evaluated on a change-triggered basis. To test it, purposefully misconfigure security group settings in the Amazon EC2 console to allow inbound traffic. This should trigger a Security Hub finding which remediates the security issue by undoing the misconfiguration.

. Select *Security Groups* in the Amazon EC2 console. 
. Select the *Security group ID* of the default VPC.
. Select *Edit inbound rules*.

:xrefstyle: short
[#edit-inbound-rules]
.Edit inbound rules
[link=images/edit-inbound-rules.png]
image::../images/edit-inbound-rules.png[Architecture,width=100%,height=100%]

[start=4]
. Select *Add rule*.
. Select *SSH* as the *Type* and *0.0.0.0/0* as the *Source*.

:xrefstyle: short
[#ssh-rule]
.SSH rule
[link=images/SSH-rule.png]
image::../images/SSH-rule.png[Architecture,width=100%,height=100%]

[start=6]
. Select *Save rules*. Make a note of the Security Group ARN.

. In Security Hub, select Findings. Locate the finding that corresponds to the misconfiguration.
. Select the check box next to the finding and select *Actions*.
. Select *PCI EC2.2* from the drop-down list. A message displays that findings were successfully sent to CloudWatch Events.
. In Systems Manager, select *Automation*. You should see a successful automation execution that corresponds to the PCI EC2.2 remediation.
. To confirm success of the remediation, select *Security Groups* in the Amazon EC2 console. Then select the *Security group ID* of the default VPC. Confirm that the SSH rule is removed from the *Inbound rules* tab.

== Best practices for using {partner-product-name} on AWS
AWS categorizes each AWS Security Hub service action into one of five access levels: `List`, `Read`, `Write`, `Permissions management`, or `Tagging`. To allow a large group of users to access `List` and `Read` Security Hub actions, and only a small group to access `Write` action, use managed IAM policies. For more information, see https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html[Security best practices in IAM^].

Security Hub ingests findings generated from integrated providers (both third-party services using https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-findings-format.html[AWS Security Finding Format (ASFF)^].

== Security
This Quick Start follows security best practices and guidelines as documented in link:https://docs.aws.amazon.com/securityhub/latest/userguide/security.html[Security in AWS Security Hub^].